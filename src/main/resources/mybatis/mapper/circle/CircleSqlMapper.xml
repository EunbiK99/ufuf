<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cu.ufuf.circle.mapper.CircleSqlMapper">

    <insert id="circleInfoInsert">
        INSERT into circle(circle_small_category_id, circle_grade_id, user_id, circle_name, circle_university, circle_content,circle_image) values(
            #{circle_small_category_id}, 1, #{user_id}, #{circle_name}, #{circle_university}, #{circle_content}, #{circle_image}
        )
    </insert>

    <select id="circlemiddlecategoryInfoAll" resultType="com.cu.ufuf.dto.CircleMiddleCategoryDto">
        SELECT * from circle_middle_category
    </select>

    <select id="circlesmallcategoryInfoAll" resultType="com.cu.ufuf.dto.CircleSmallCategoryDto">
        SELECT * from circle_small_category
    </select>
    <select id="circlesmallcategoryInfoByMiddleId" resultType="com.cu.ufuf.dto.CircleSmallCategoryDto">
        SELECT * from circle_small_category where circle_middle_category_id = #{circle_middle_category_id}
    </select>
    <insert id="circleNoticeImageInfoInsert">
        INSERT INTO circle_notice_image(circle_id,circle_notice_image) values(
	        #{circle_id}, #{circle_notice_image}
        )
    </insert>
    <select id="circleIdMaxByUserId" resultType="int">
        SELECT max(circle_id) from circle where user_id = #{user_id}
    </select>
    <insert id="cirlceMemberinfoInsert">
        insert into circle_member(circle_id, user_id, circle_position) values(
            #{circle_id}, #{user_id}, #{circle_position}
        )
    </insert>
    <select id="circleInfoHotThree" resultType="com.cu.ufuf.dto.CircleDto">
        SELECT *
        FROM circle c
        WHERE c.circle_id IN (
            SELECT c.circle_id
            FROM circle c
            INNER JOIN circle_member cm ON c.circle_id = cm.circle_id
            GROUP BY c.circle_id
            ORDER BY COUNT(*) DESC 
        )
        limit 3
    </select>
    <select id="circleNewListOrderByCircleId" resultType="com.cu.ufuf.dto.CircleDto">
        SELECT * from circle order by circle_id desc
    </select>
    <select id="circlesmallCategoryListBysmallCategoryId" resultType="com.cu.ufuf.dto.CircleSmallCategoryDto">
        select * from circle_small_category where circle_small_category_id = #{circle_small_category_id}
    </select>
    <select id="circleGradeInfoByGradeId" resultType="com.cu.ufuf.dto.CircleGradeDto">
        select * from circle_grade where circle_grade_id = #{circle_grade_id}
    </select>
    <select id="circleMemberCountInfo" resultType="int">
        SELECT count(*) from circle_member where circle_id = #{circle_id}
    </select>
    <select id="circleInfoByCircleId" resultType="com.cu.ufuf.dto.CircleDto">
        select * from circle where circle_id = #{circle_id}
    </select>
    <select id="circleNoticeImageInfoByCircleId" resultType="com.cu.ufuf.dto.CircleNoticeImageDto">
        select * from circle_notice_image where circle_id = #{circle_id}
    </select>
    <select id="circlemiddleCategoryInfoByMiddleCategoryId" resultType="com.cu.ufuf.dto.CircleMiddleCategoryDto">
        select * from circle_middle_category where circle_middle_category_id = #{circle_middle_category_id}
    </select>
    <insert id="circleJoinApplyInsert">
        INSERT into circle_join_apply(circle_id, user_id, join_submit) values(
            #{circle_id}, #{user_id}, #{join_submit}
        )
    </insert>
    <select id="circleMemberInfoByUserId" resultType="com.cu.ufuf.dto.CircleMemberDto">
        select * from circle_member where user_id = #{user_id}
    </select>
    <select id="circleMemberInfoByCircleId" resultType="com.cu.ufuf.dto.CircleMemberDto">
        select * from circle_member where circle_id = #{circle_id}
    </select>
    <select id="circleboardInfoByCircleMemberId" resultType="com.cu.ufuf.dto.CircleBoardDto">
        select * from circle_board where circle_member_id = #{circle_member_id} order by circle_board_id desc
    </select>
    <select id="userInfoByUserId" resultType="com.cu.ufuf.dto.UserInfoDto">
        select * from user_info where user_id = #{user_id}
    </select>
    <select id="circleMemberInfoByUserIdAndCircleId" resultType="com.cu.ufuf.dto.CircleMemberDto">
        select * from circle_member where user_id = #{user_id} and circle_id = #{circle_id}
    </select>

    <insert id="circleboardDtoInsert">
        insert into circle_board(circle_member_id, board_title, board_content, main_image, board_cnt) values(
            #{circle_member_id}, #{board_title}, #{board_content}, #{main_image}, #{board_cnt}
        )
    </insert>
    <select id="boardIdMaxByCircleMemberId" resultType="int">
        select max(circle_board_id) from circle_board where circle_member_id = #{circle_member_id}
    </select>
    <insert id="circleboardImageDtoInsert">
        insert into circle_board_image(circle_board_id, sub_image) values(
            #{circle_board_id}, #{sub_image}
        )
    </insert>
    <insert id="circleVoteInsert">
        insert into circle_vote(vote_end_time ,circle_member_id, vote_title, vote_theme) values(
            #{vote_end_time} ,#{circle_member_id}, #{vote_title}, #{vote_theme}
        )
    </insert>
    <insert id="circleVoteOptionInsert">
        insert into circle_vote_option(circle_vote_id, option_content, option_image) values(
            #{circle_vote_id}, #{option_content}, #{option_image}
        )
    </insert>
    <select id="circleVoteMaxCircleVoteId" resultType="int">
        SELECT max(circle_vote_id) from circle_vote WHERE circle_member_id = #{circle_member_id}
    </select>
    <select id="circleVoteBoardListByCircleMemberId" resultType="com.cu.ufuf.dto.CircleVoteDto">
        select * from circle_vote where circle_member_id = #{circle_member_id} order by circle_vote_id desc
    </select>
    <select id="circleVoteOptionInfoByCircleVoteId" resultType="com.cu.ufuf.dto.CircleVoteOptionDto">
        select * from circle_vote_option where circle_vote_id = #{circle_vote_id}
    </select>
    <select id="circleVoteCompleteInfoByVoteOptionId" resultType="com.cu.ufuf.dto.CircleVoteCompleteDto">
        select * from circle_vote_complete where vote_option_id = #{vote_option_id}
    </select>
    <select id="circleVoteCompleteCntByVoteOptionId" resultType="int">
        select count(*) from circle_vote_complete where vote_option_id = #{vote_option_id}
    </select>
    <select id="circleVoteInfoByCircleVoteId" resultType="com.cu.ufuf.dto.CircleVoteDto">
        select * from circle_vote where circle_vote_id = #{circle_vote_id}
    </select>
    <insert id="circleVoteCompleteInfoInsert">
        insert into circle_vote_complete(vote_option_id, circle_member_id) values(
            #{vote_option_id}, #{circle_member_id}
        )
    </insert>
    <insert id="circleScheduleInfoInsert">
        insert into circle_schedule(circle_member_id, schedule_title, schedule_content, participation, schedule_fee, start_time, end_time) values(
            #{circle_member_id}, #{schedule_title}, #{schedule_content}, #{participation}, #{schedule_fee}, #{start_time}, #{end_time}
        )
    </insert>
    <insert id="circleScheduleApplicationInfoInsert">
        insert into circle_schedule_application(circle_schedule_id, circle_member_id) values(
            #{circle_schedule_id}, #{circle_member_id}
        )
    </insert>
    <insert id="circleScheduleAttenDanceInfoInfoInsert">
        INSERT into circle_schedule_attendance(circle_schedule_application_id, attendance) values(
            #{circle_schedule_application_id}, #{attendance}
        )
    </insert>
    <select id="circleScheduleListAllByCircleMemberId" resultType="com.cu.ufuf.dto.CircleScheduleDto">
        SELECT * from circle_schedule WHERE circle_member_id = #{circle_member_id}
    </select>
    <select id="voteChecked" resultType="java.lang.Boolean">
        select EXISTS(SELECT * from circle_vote_complete 
        WHERE vote_option_id = #{vote_option_id} 
        AND circle_member_id = #{circle_member_id}) as boo 
        from dual
    </select>
    <select id="scheduleApplyCheckPAndAByCircleMemberId" resultType="java.lang.Boolean">
        SELECT EXISTS(SELECT * from circle_member 
        where circle_position IN ('P', 'A') 
        AND circle_member_id = #{circle_member_id}) as A 
        from dual
    </select>
    <select id="scheduleApplyCheckByCircleScheduleIdAndCircleMemberId" resultType="java.lang.Boolean">
        SELECT EXISTS(SELECT * from circle_schedule_application 
        WHERE circle_schedule_id = #{circle_schedule_id} 
        and circle_member_id = #{circle_member_id}) as A 
        from dual
    </select>
    <select id="circleBoartCnt" resultType="int">
        SELECT count(*) from circle_board 
        where circle_member_id 
        IN (SELECT circle_member_id  from circle_member where circle_id = #{circle_id})
    </select>

    
    
</mapper>