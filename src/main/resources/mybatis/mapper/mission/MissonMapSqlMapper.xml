<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cu.ufuf.mission.mapper.MissionMapSqlMapper">

<!-- 미션 등록 -->
<insert id="insertMission">
    <selectKey keyProperty="mission_id" resultType="int" order="AFTER">
        SELECT LAST_INSERT_ID() AS mission_id
    </selectKey>

    INSERT INTO mission_info (
        user_id, 
        title, 
        detail, 
        status, 
        limit_time
        )
    VALUES(
        #{user_id}, 
        #{title}, 
        #{detail}, 
        #{status}, 
        #{limit_time}
    )
</insert>

<insert id="insertMissionCourse">
    INSERT INTO mission_course(
        mission_id,
        content,
        reward,
        lat,
        lng
        )
    VALUES(
        #{mission_id},
        #{content},
        #{reward},
        #{lat},
        #{lng}
    )
</insert>

<select id="selectMissionById" resultType="com.cu.ufuf.dto.MissionInfoDto">
    SELECT * FROM mission_info
    where mission_id = ${mission_id}
</select>

<select id="selectMissionByOrderId" resultType="com.cu.ufuf.dto.MissionInfoDto">
    select mi.* from order_info oi 
    inner join item_info ii on oi.item_id = ii.item_id
    inner join mission_info mi on ii.merchan_id = mi.mission_id 
    where oi.order_id = #{order_id}
</select>

<select id="selectAllMission" resultType="com.cu.ufuf.dto.MissionInfoDto">
    select * from mission_info
    WHERE status = '모집중'
</select>

<select id="selectCourseByMission" resultType="com.cu.ufuf.dto.MissionCourseDto">
    select * from mission_course
    where mission_id = #{mission_id}
</select>

<update id="updateStatus">
    update mission_info
    set status = #{param2}
    where mission_id = #{param1}
</update>

<select id="selectUserById" resultType="com.cu.ufuf.dto.UserInfoDto">
    select * from user_info
    where user_id = #{user_id}
</select>

<insert id="insertMissionChatRoom">
    insert into mission_chat_room(
        mission_id,
        user_id
        )
    VALUES(
        #{mission_id},
        #{user_id}
    )
</insert>






















</mapper>